<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë¹„ë‹í•˜ìš°ìŠ¤ ê·¸ë¦¬ë“œ ìƒì„±ê¸°</title>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
    }
    .controls {
      margin-bottom: 20px;
    }
    .controls input {
      margin-right: 10px;
      padding: 5px;
    }
    .controls button {
      padding: 5px 10px;
    }
    .value-selector {
      margin-bottom: 10px;
    }
    .selected {
      font-weight: bold;
      color: green;
    }
    .grid {
      display: grid;
      gap: 2px;
      margin-top: 10px;
    }
    .cell {
      width: 30px;
      height: 30px;
      background-color: lightgray;
      border: 1px solid #999;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 12px;
      cursor: pointer;
      user-select: none;
    }
  </style>
</head>
<body>

  <h2>ğŸ§± ë¹„ë‹í•˜ìš°ìŠ¤ ê·¸ë¦¬ë“œ ìƒì„±ê¸°</h2>

  <div class="controls">
    <label>Farm ID:</label>
    <input type="number" id="farmId" value="1" min="1">
    <label>í•˜ìš°ìŠ¤ ì´ë¦„:</label>
    <input type="text" id="houseName" placeholder="ì˜ˆ: 1ë™">
    <label>í–‰:</label>
    <input type="number" id="rows" value="10" min="1">
    <label>ì—´:</label>
    <input type="number" id="cols" value="10" min="1">
    <button onclick="generateGrid()">ê·¸ë¦¬ë“œ ìƒì„±</button>
    <button onclick="submitGrid()">âœ… ì €ì¥</button>
  </div>

  <div class="value-selector">
    <strong>ì„ íƒ ê°’:</strong>
    <button onclick="setCurrentValue(0)" id="btn-0">0</button>
    <button onclick="setCurrentValue(1)" id="btn-1">1</button>
    <button onclick="setCurrentValue(2)" id="btn-2">2</button>
  </div>

  <div class="grid" id="grid"></div>

  <script>
    let currentValue = 0;
    let isDragging = false;

    function setCurrentValue(value) {
      currentValue = value;
      [0, 1, 2].forEach(v => {
        document.getElementById('btn-' + v).classList.remove('selected');
      });
      document.getElementById('btn-' + value).classList.add('selected');
    }

    function getColor(value) {
      if (value === 0) return 'red';
      if (value === 1) return 'black';
      if (value === 2) return 'blue';
      return 'lightgray';
    }

    function applyValue(cell) {
      cell.textContent = currentValue;
      cell.dataset.value = currentValue;
      cell.style.backgroundColor = getColor(currentValue);
      cell.style.color = currentValue === 1 ? 'white' : 'black';
    }

    function generateGrid() {
      const rows = parseInt(document.getElementById('rows').value);
      const cols = parseInt(document.getElementById('cols').value);
      const grid = document.getElementById('grid');

      grid.style.gridTemplateColumns = `repeat(${cols}, 30px)`;
      grid.style.gridTemplateRows = `repeat(${rows}, 30px)`;
      grid.innerHTML = '';

      for (let i = 0; i < rows * cols; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.value = '0';
        cell.textContent = '0';
        cell.style.backgroundColor = getColor(0);
        cell.addEventListener('mousedown', () => {
          isDragging = true;
          applyValue(cell);
        });
        cell.addEventListener('mouseenter', () => {
          if (isDragging) applyValue(cell);
        });
        cell.addEventListener('click', () => applyValue(cell));
        grid.appendChild(cell);
      }
    }

    document.addEventListener('mouseup', () => {
      isDragging = false;
    });

    function submitGrid() {
      const rows = parseInt(document.getElementById('rows').value);
      const cols = parseInt(document.getElementById('cols').value);
      const houseName = document.getElementById('houseName').value;
      const farmId = parseInt(document.getElementById('farmId').value);
      const cells = document.querySelectorAll('.cell');

      const gridData = [];
      for (let r = 0; r < rows; r++) {
        const row = [];
        for (let c = 0; c < cols; c++) {
          const index = r * cols + c;
          const value = parseInt(cells[index].dataset.value || 0);
          row.push(value);
        }
        gridData.push(row);
      }

      fetch('/api/greenhouses/create', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          farm_id: farmId,
          name: houseName,
          num_rows: rows,
          num_cols: cols,
          grid_data: gridData
        })
      })
      .then(res => res.json())
      .then(data => alert(data.message))
      .catch(err => alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ"));
    }

    // ì´ˆê¸°í™”
    setCurrentValue(0);
    generateGrid();
  </script>

</body>
</html>
